!function(){let e=[],t=[],n=1;const o=50,a=new Set,i=io();i.on("voteUpdate",(function(e){const n=t.find((t=>t.matchup_id===e.matchupId));n&&(n.vote_count=e.newVoteCount,r(),s())})),document.addEventListener("DOMContentLoaded",(function(){s(),c(),l();const e=document.getElementById("searchInput");e.addEventListener("input",(()=>{n=1,t&&t.length>0&&r()}))}));async function s(){try{const e=await fetch("/api/stats"),t=await e.json();document.getElementById("totalVotes").textContent=t.totalVotes||0,document.getElementById("uniqueVoters").textContent=t.uniqueVoters||0,document.getElementById("totalMatchups").textContent=t.totalMatchups||0,document.getElementById("activeToday").textContent=t.activeToday||0}catch(e){console.error("Error loading stats:",e)}}async function c(){try{const t=await fetch("/api/check-votes",{method:"POST",headers:{"Content-Type":"application/json"}}),n=await t.json();e=n.votedMatchups||[]}catch(e){console.error("Error loading voted matchups:",e)}}async function l(){try{const e=await fetch("/api/future-matchups");t=await e.json(),document.getElementById("loading").style.display="none",r()}catch(e){console.error("Error loading matchups:",e),u("Failed to load matchups. Please refresh the page."),document.getElementById("loading").style.display="none"}}function r(){const i=document.getElementById("matchupsList");i.innerHTML="";if(!t||0===t.length)return;let s=[...t].sort(((e,t)=>t.vote_count-e.vote_count));const c=document.getElementById("searchInput").value.trim().toLowerCase();if(c){const e=c.split(" vs ");if(2===e.length){const t=e[0].trim(),n=e[1].trim(),o=s.findIndex((e=>{const o=e.candidate1.toLowerCase(),a=e.candidate2.toLowerCase();return o===t&&a===n||o===n&&a===t}));if(o>-1){const[e]=s.splice(o,1);s.unshift(e)}}}const l=(n-1)*o,r=l+o,d=s.slice(l,r),m=Math.max(...s.map((e=>e.vote_count)),1);d.forEach(((t,n)=>{const o=e.includes(t.matchup_id),a=t.vote_count/m*100,s="linear-gradient(135deg, #ff6b35, #ff4500)",c=document.createElement("div");c.className="bar-row",c.innerHTML=`\n            <div class="matchup-name">${t.candidate1} vs ${t.candidate2}</div>\n            <div class="bar-container">\n                <div class="vote-bar" style="width: ${a}%; background: ${s};">\n                    <div class="vote-count">${t.vote_count} votes</div>\n                </div>\n            </div>\n            <button class="vote-btn ${o?"voted":""}" \n                    onclick="voteForMatchup('${t.matchup_id}')">\n                <i class="fa-solid fa-fire"></i>\n            </button>\n        `,i.appendChild(c)})),renderPagination()}window.voteForMatchup=async function(n){try{a.add(n);const o=await fetch("/api/vote-future",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({matchupId:n})}),i=await o.json();if(i.success){if("voted"===i.action){e.push(n),p("Vote recorded! ðŸ”¥")}else if("unvoted"===i.action){const o=e.indexOf(n);o>-1&&e.splice(o,1),p("Vote removed")}r(),setTimeout((()=>{a.delete(n)}),1e3)}else a.delete(n),u(i.error||"Failed to record vote")}catch(t){a.delete(n),console.error("Error voting:",t),u("Failed to record vote. Please try again.")}};function u(e){const t=document.getElementById("errorMessage");t.textContent=e,t.className="error",t.style.display="block",setTimeout((()=>{t.style.display="none"}),5e3)}function p(e){const t=document.getElementById("errorMessage");t.textContent=e,t.className="success",t.style.display="block",setTimeout((()=>{t.style.display="none"}),3e3)}function renderPagination(){const e=document.getElementById("pagination");e.innerHTML="";const a=Math.ceil(t.length/o);if(a<=1)return;const i=(e,t)=>{const o=document.createElement("button");return o.textContent=e,o.className="pagination-btn",t===n&&o.classList.add("active"),o.disabled=null===t||t<1||t>a,o.onclick=()=>{null!==t&&t>=1&&t<=a&&(n=t,r())},o},s=()=>{const e=document.createElement("span");return e.textContent="...",e.style.margin="0 10px",e.style.alignSelf="center",e};e.appendChild(i("Previous",n-1));const c=new Set;c.add(1),c.add(a),c.add(n),n>1&&c.add(n-1),n<a&&c.add(n+1);const l=Array.from(c).sort(((e,t)=>e-t));let u=0;l.forEach((t=>{t>u+1&&e.appendChild(s()),e.appendChild(i(t,t)),u=t})),e.appendChild(i("Next",n+1))}}();
